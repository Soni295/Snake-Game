var __extends=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function s(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(s.prototype=n.prototype,new s)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,n=1,s=arguments.length;n<s;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)},HandleElement=function(){function t(t){this.element=document.getElementById(t)}return t.prototype.getElement=function(){return this.element.innerHTML},t.prototype.getValue=function(){return this.element.value},t.prototype.setValueElement=function(t){this.element.innerHTML=t},t}(),Rules=function(){function t(t,e,n){this.snake=t,this.egg=e,this.game=n,this.width=this.game.canvas.canvas.width,this.height=this.game.canvas.canvas.height}return t.prototype.check=function(){var t=this.snake.snake.body.map(function(t){return JSON.stringify(t)}),e=t[0],n=t.slice(1);this.eatEgg(e),this.eatItSelf(e,n),this.limit(e)},t.prototype.eatItSelf=function(t,e){e.some(function(e){return e==t})&&this.game.endGame()},t.prototype.eatEgg=function(t){t===JSON.stringify(this.egg.position)&&this.game.eat()},t.prototype.limit=function(t){var e=JSON.parse(t);switch(!0){case e.x>=this.width:case e.x<0:case e.y>=this.height:case e.y<0:this.game.endGame()}},t}(),Modal=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.hideElement=function(){this.element.classList.add("fade-out")},e.prototype.showElement=function(){this.element.classList.remove("fade-out"),this.element.classList.add("fade-in")},e}(HandleElement),className={SHOW:"fade-in",HIDE:"fade-out"},ID={SCORE:"score",SPEED:"speed",SCREEN:"screen",MODAL:"modal",BTN_MODAL:"btn-modal",SPEED_SELECTOR:"speed-selector"},Canvas=function(){function t(t){this.canvas=document.getElementById(ID.SCREEN),this.context=this.canvas.getContext("2d"),this.scale=t}return t.prototype.clearCanvas=function(){var t=this.canvas,e=t.width,n=t.height;this.context.clearRect(0,0,e,n)},t.prototype.paintCanvas=function(t,e){this.context.fillStyle=e,this.context.fillRect(t.x,t.y,this.scale,this.scale)},t}(),actionTypes={ARROWUP:"ArrowUp",ARROWDOWN:"ArrowDown",ARROWLEFT:"ArrowLeft",ARROWRIGHT:"ArrowRight"},reducer=function(t,e){var n;return((n={})[actionTypes.ARROWUP]=function(){return __assign(__assign({},t),{y:t.y-e.scale})},n[actionTypes.ARROWDOWN]=function(){return __assign(__assign({},t),{y:t.y+e.scale})},n[actionTypes.ARROWLEFT]=function(){return __assign(__assign({},t),{x:t.x-e.scale})},n[actionTypes.ARROWRIGHT]=function(){return __assign(__assign({},t),{x:t.x+e.scale})},n)[e.type]()||__assign({},t)},Snake=function(){function t(t,e){this.screen=t,this.scale=e}return t.prototype.start=function(){this.snake={body:[{x:2*this.scale,y:0},{x:this.scale,y:0},{x:0,y:0}],direction:"ArrowRight"},this.ate=0,this.direction="",this.pause=!1,this.draw()},t.prototype.draw=function(t){void 0===t&&(t="#FFFFFF");for(var e=0,n=this.snake.body;e<n.length;e++){var s=n[e];this.screen.paintCanvas(s,t)}},t.prototype.generate=function(){var t=this.snake.body.length-1,e=this.snake.body.slice(0,t);this.snake.body=[this.snake.body[0]].concat(e)},t.prototype.update=function(){this.generate(),this.move(),this.draw()},t.prototype.move=function(){var t={scale:this.scale,type:this.snake.direction};this.snake.body[0]=reducer(this.snake.body[0],t)},t.prototype.turn=function(t){this.snake.direction=t},t.prototype.eat=function(){this.ate++,this.snake.body[this.snake.body.length]=this.snake.body[this.snake.body.length-1]},t}(),newPosition=function(t,e){var n=e.height,s=e.width;return{x:t*(Math.floor(Math.random()*n/t-1)+1),y:t*(Math.floor(Math.random()*s/t-1)+1)}},Egg=function(){function t(t){this.scale=t.scale,this.screen=t}return t.prototype.spawn=function(){this.position=newPosition(this.scale,this.screen.canvas),this.draw()},t.prototype.draw=function(t){void 0===t&&(t="#00ff14"),this.screen.paintCanvas(this.position,t)},t.prototype.eat=function(){this.spawn()},t}(),Counter=function(t){function e(e){var n=t.call(this,e)||this;return n.data=0,n.type=e+": ",n.updateInfo(),n}return __extends(e,t),e.prototype.handleData=function(t,e){void 0===e&&(e=!1),this.data=e?t:this.data+t,this.updateInfo()},e.prototype.getData=function(){return this.data},e.prototype.updateInfo=function(){var t=this.type+this.data.toString();this.setValueElement(t)},e.prototype.reset=function(){this.data=0,this.updateInfo()},e}(HandleElement),Status=function(){function t(){this.score=new Counter(ID.SCORE),this.speed=new Counter(ID.SPEED)}return t.prototype.eat=function(t){t%5==0&&this.speed.handleData(1),this.score.handleData(5*this.speed.data)},t.prototype.setSpeed=function(t){this.speed.handleData(t,!0)},t.prototype.getSpeed=function(){return this.speed.getData()},t.prototype.reset=function(){this.score.reset()},t}(),HandleModal=function(){function t(t){var e=this;this.btn=new HandleElement(ID.BTN_MODAL),this.modal=new Modal(ID.MODAL),this.speedSelector=new HandleElement(ID.SPEED_SELECTOR),this.game=t,this.btn.element.onclick=function(){return e.start()}}return t.prototype.start=function(){this.modal.hideElement(),this.game.start()},t.prototype.selectSpeed=function(){return Number(this.speedSelector.getValue())},t.prototype.showModal=function(){this.modal.showElement()},t}(),Game=function(){function t(t){this.status=new Status,this.canvas=new Canvas(t),this.egg=new Egg(this.canvas),this.snake=new Snake(this.canvas,t),this.rules=new Rules(this.snake,this.egg,this),this.modal=new HandleModal(this),this.pause=!1,this.run=null}return t.prototype.start=function(){this.egg.spawn(),this.snake.start(),this.status.setSpeed(this.modal.selectSpeed()),this.playing()},t.prototype.updateSpeed=function(){clearInterval(this.run),this.playing()},t.prototype.playing=function(){var t=this;this.run=setInterval(function(){t.rules.check(),t.canvas.clearCanvas(),t.egg.draw(),t.snake.update()},1e3/this.status.getSpeed())},t.prototype.endGame=function(){clearInterval(this.run),this.modal.showModal(),this.canvas.clearCanvas(),this.status.reset()},t.prototype.pauseGame=function(){this.pause=!this.pause,this.pause?clearInterval(this.run):this.playing()},t.prototype.turn=function(t){this.snake.turn(t)},t.prototype.eat=function(){this.snake.eat(),this.egg.eat(),this.status.eat(this.snake.ate),this.updateSpeed()},t}(),lever=document.getElementById("lever"),base=document.getElementById("base"),snakeKeys=Object.keys(actionTypes).map(function(t){return actionTypes[t]}),scale=20,game=new Game(scale);window.addEventListener("keydown",function(t){var e=t.key;switch("p"===e&&game.pauseGame(),snakeKeys.some(function(t){return t===e})&&game.turn(e),e){case"ArrowRight":lever.style.transform="rotate(45deg) translateX(10px)",base.style.transform="rotate(315deg) translateX(-13px) translateY(-10px)";break;case"ArrowLeft":lever.style.transform="rotate(-45deg) translateX(-10px)",base.style.transform="rotate(45deg) translateX(-16px) translateY(16px)";break;case"ArrowDown":case"ArrowUp":lever.style.setProperty("--ball-down","-18px")}setTimeout(function(){lever.style.transform="",base.style.transform="",lever.style.setProperty("--ball-down","-31px")},200)});
